{
  "version": 3,
  "sources": [
    "../../node_modules/browser-pack-flat/_prelude",
    "../core/lib/es-utils/assign.js",
    "../core/lib/clone-client.js",
    "../core/lib/extract-object.js",
    "src/request-info.js",
    "src/express.js",
    "../../node_modules/browser-pack-flat/_postlude"
  ],
  "names": [],
  "mappings": "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",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.bugsnagExpress = f()}})(function(){var define,module,exports;\n",
    "// extends helper from babel\n// https://github.com/babel/babel/blob/916429b516e6466fd06588ee820e40e025d7f3a3/packages/babel-helpers/src/helpers.js#L377-L393\nmodule.exports = function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i]\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key]\n      }\n    }\n  }\n  return target\n}\n",
    "const assign = require('./es-utils/assign')\n\nconst onCloneCallbacks = []\n\nmodule.exports = (client) => {\n  const clone = new client.Client({}, {}, [], client._notifier)\n\n  clone._config = client._config\n\n  // changes to these properties should not be reflected in the original client,\n  // so ensure they are are (shallow) cloned\n  clone._breadcrumbs = client._breadcrumbs.slice()\n  clone._metadata = assign({}, client._metadata)\n  clone._features = [...client._features]\n  clone._featuresIndex = assign({}, client._featuresIndex)\n  clone._user = assign({}, client._user)\n  clone._context = client._context\n\n  clone._cbs = {\n    e: client._cbs.e.slice(),\n    s: client._cbs.s.slice(),\n    sp: client._cbs.sp.slice(),\n    b: client._cbs.b.slice()\n  }\n\n  clone._logger = client._logger\n  clone._delivery = client._delivery\n  clone._sessionDelegate = client._sessionDelegate\n\n  onCloneCallbacks.forEach(callback => { callback(clone) })\n\n  return clone\n}\n\nmodule.exports.registerCallback = callback => { onCloneCallbacks.push(callback) }\n",
    "// Given a host object, return the value at host[key] if it is an object\n// and it has at least one key/value\n\nmodule.exports = (host, key) => {\n  if (host[key] && typeof host[key] === 'object' && Object.keys(host[key]).length > 0) {\n    return host[key]\n  } else {\n    return undefined\n  }\n}\n",
    "const extractObject = require('@bugsnag/core/lib/extract-object')\n\nmodule.exports = req => {\n  const connection = req.connection\n  const address = connection && connection.address && connection.address()\n  const portNumber = address && address.port\n  const port = (!portNumber || portNumber === 80 || portNumber === 443) ? '' : `:${portNumber}`\n  const protocol = typeof req.protocol !== 'undefined' ? req.protocol : (req.connection.encrypted ? 'https' : 'http')\n  const hostname = (req.hostname || req.host || req.headers.host || '').replace(/:\\d+$/, '')\n  const url = `${protocol}://${hostname}${port}${req.url}`\n  const request = {\n    url: url,\n    path: req.path || req.url,\n    httpMethod: req.method,\n    headers: req.headers,\n    httpVersion: req.httpVersion\n  }\n\n  request.params = extractObject(req, 'params')\n  request.query = extractObject(req, 'query')\n  request.body = extractObject(req, 'body')\n\n  request.clientIp = req.ip || (connection ? connection.remoteAddress : undefined)\n  request.referer = req.headers.referer || req.headers.referrer\n\n  if (connection) {\n    request.connection = {\n      remoteAddress: connection.remoteAddress,\n      remotePort: connection.remotePort,\n      bytesRead: connection.bytesRead,\n      bytesWritten: connection.bytesWritten,\n      localPort: portNumber,\n      localAddress: address ? address.address : undefined,\n      IPVersion: address ? address.family : undefined\n    }\n  }\n  return request\n}\n",
    "/* eslint node/no-deprecated-api: [error, {ignoreModuleItems: [\"domain\"]}] */\nconst domain = require('domain')\nconst extractRequestInfo = require('./request-info')\nconst clone = require('@bugsnag/core/lib/clone-client')\nconst handledState = {\n  severity: 'error',\n  unhandled: true,\n  severityReason: {\n    type: 'unhandledErrorMiddleware',\n    attributes: { framework: 'Express/Connect' }\n  }\n}\n\nmodule.exports = {\n  name: 'express',\n  load: client => {\n    const requestHandler = (req, res, next) => {\n      const dom = domain.create()\n\n      // Get a client to be scoped to this request. If sessions are enabled, use the\n      // resumeSession() call to get a session client, otherwise, clone the existing client.\n      const requestClient = client._config.autoTrackSessions ? client.resumeSession() : clone(client)\n\n      // attach it to the request\n      req.bugsnag = requestClient\n\n      // extract request info and pass it to the relevant bugsnag properties\n      requestClient.addOnError((event) => {\n        const { metadata, request } = getRequestAndMetadataFromReq(req)\n        event.request = { ...event.request, ...request }\n        event.addMetadata('request', metadata)\n      }, true)\n\n      if (!client._config.autoDetectErrors) return next()\n\n      // unhandled errors caused by this request\n      dom.on('error', (err) => {\n        const event = client.Event.create(err, false, handledState, 'express middleware', 1)\n        req.bugsnag._notify(event, () => {}, (e, event) => {\n          if (e) client._logger.error('Failed to send event to Bugsnag')\n          req.bugsnag._config.onUncaughtException(err, event, client._logger)\n        })\n        if (!res.headersSent) {\n          res.statusCode = 500\n          res.end('Internal server error')\n        }\n      })\n\n      return dom.run(next)\n    }\n\n    const errorHandler = (err, req, res, next) => {\n      if (!client._config.autoDetectErrors) return next(err)\n\n      const event = client.Event.create(err, false, handledState, 'express middleware', 1)\n\n      const { metadata, request } = getRequestAndMetadataFromReq(req)\n      event.request = { ...event.request, ...request }\n      event.addMetadata('request', metadata)\n\n      if (req.bugsnag) {\n        req.bugsnag._notify(event)\n      } else {\n        client._logger.warn(\n          'req.bugsnag is not defined. Make sure the @bugsnag/plugin-express requestHandler middleware is added first.'\n        )\n        client._notify(event)\n      }\n\n      next(err)\n    }\n\n    return { requestHandler, errorHandler }\n  }\n}\n\nconst getRequestAndMetadataFromReq = req => {\n  const { body, ...requestInfo } = extractRequestInfo(req)\n  return {\n    metadata: requestInfo,\n    request: {\n      body,\n      clientIp: requestInfo.clientIp,\n      headers: requestInfo.headers,\n      httpMethod: requestInfo.httpMethod,\n      url: requestInfo.url,\n      referer: requestInfo.referer\n    }\n  }\n}\n\nmodule.exports.default = module.exports\n",
    "\nreturn _$express_4;\n\n});\n"
  ]
}