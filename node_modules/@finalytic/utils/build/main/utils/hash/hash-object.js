"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hashObject = void 0;
const array_1 = require("../array");
const hash_1 = require("./hash");
const hashObject = (obj, keys, hash = true) => {
    const result = [];
    if (!keys)
        keys = (0, array_1.sortBy)(Object.keys(obj));
    for (const key of keys) {
        const value = convert(obj[key]);
        if (value)
            result.push(`${String(key)}_${String(value)}`);
    }
    return hash ? (0, hash_1.hashId)(result.join('_')) : result.join('_');
};
exports.hashObject = hashObject;
function convert(value) {
    if (value === null || value === undefined)
        return undefined;
    if (['number', 'string', 'boolean', 'bigint'].includes(typeof value))
        return String(value);
    if (typeof value === 'object' && 'toISOString' in value)
        return value.toISOString().split('T')[0];
    if (Array.isArray(value) && value.length && convert(value[0]) !== undefined)
        return (0, array_1.sortBy)((0, array_1.uniqueBy)(value.map((x) => String(x)))).join(',');
    return undefined;
}
