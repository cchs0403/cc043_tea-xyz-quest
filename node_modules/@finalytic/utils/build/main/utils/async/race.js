"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.race = void 0;
function race(promises, { ignoreErrors = false, condition, }) {
    let resolved = 0;
    let isResolved = false;
    return new Promise((resolve, reject) => {
        for (const promise of promises) {
            promise
                .then((res) => {
                resolved += 1;
                if (condition) {
                    const isTruthy = condition ? condition(res) : res;
                    if (!isResolved && isTruthy) {
                        resolve(res);
                        isResolved = true;
                    }
                    if (resolved === promises.length && !isResolved)
                        reject(new Error('Could not resolve any condition'));
                }
                else if (!isResolved) {
                    resolve(res);
                    isResolved = true;
                }
            })
                .catch((err) => {
                if (!ignoreErrors && !isResolved) {
                    isResolved = true;
                    reject(err);
                }
                resolved += 1;
                if (resolved === promises.length && !isResolved)
                    reject(err);
            });
        }
    });
}
exports.race = race;
