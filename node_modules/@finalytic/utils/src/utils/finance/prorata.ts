import dayjs from 'dayjs';

export function calcProrata(
  start: dayjs.ConfigType,
  end: dayjs.ConfigType,
  currentDate: dayjs.ConfigType,
  {
    dimension = 'month',
    endInclusive = false,
  }: {
    dimension?: dayjs.OpUnitType;
    endInclusive?: boolean;
  } = {}
) {
  const checkIn = dayjs(start).startOf('day');
  let checkOut = dayjs(end).startOf('day');
  if (endInclusive) checkOut = checkOut.add(1, 'day');
  const totalDays = Math.abs(checkIn.diff(checkOut, 'days'));
  let current = dayjs(checkIn);
  let days = 0;
  while (current < checkOut) {
    if (current.isSame(currentDate, dimension)) {
      days = days + 1;
    }
    current = current.add(1, 'day');
  }

  return {
    ratio: days / totalDays,
    totalDays,
    daysInCurrent: days,
  };
}
